<div class="mt-6">
  <!-- Encabezado -->
  <div class="px-4 sm:px-12 mb-4">
    <div
      class="inline-flex items-center gap-2 rounded-full border border-pink-200 bg-pink-50 px-3 py-1 text-xs text-pink-700"
    >
      <span class="h-2 w-2 rounded-full bg-pink-500"></span>
      Inventario
    </div>
    <h1 class="mt-2 text-3xl font-semibold tracking-tight text-pink-500">
      Mis categorías
    </h1>
    <p class="text-sm text-slate-500 mt-1">
      Visualiza, crea y administra las categorías de tu tienda.
    </p>
  </div>

  <!-- Contenido -->
  <p-tabView>
    <!-- TAB 1: Categorías normales -->
    <p-tabPanel header="Categorías">
      <!-- Crear nueva categoría -->
      <div class="px-4 sm:px-12 mb-6">
        <form
          [formGroup]="newCategoryForm"
          (ngSubmit)="createCategory()"
          class="flex flex-col sm:flex-row items-center gap-3"
        >
          <!-- Nombre -->
          <input
            type="text"
            pInputText
            formControlName="name"
            placeholder="Nueva categoría"
            class="flex-1"
          />

          <!-- Subir imagen -->
          <input
            type="file"
            accept="image/*"
            (change)="onFileSelected($event)"
            class="text-sm"
          />

          <!-- Botón crear -->
          <button
            type="submit"
            pButton
            icon="pi pi-plus"
            class="p-button-rounded p-button-success"
            [disabled]="newCategoryForm.invalid"
          ></button>
        </form>
      </div>
      <div class="px-4 sm:px-12">
        <ng-container *ngIf="categories?.length; else emptyTpl">
          <p-accordion
            class="w-full"
            expandIcon="pi pi-plus"
            collapseIcon="pi pi-minus"
          >
            <p-accordionTab
              *ngFor="let c of categories"
              (onOpen)="c.isOpen = true; loadProducts(c)"
              (onClose)="c.isOpen = false"
            >
              <!-- HEADER -->
              <ng-template pTemplate="header">
                <span class="flex items-center gap-3 w-full">
                  <p-avatar
                    *ngIf="c.imageUrl; else defaultIcon"
                    [image]="c.imageUrl"
                    shape="circle"
                    styleClass="border border-slate-200"
                  ></p-avatar>
                  <ng-template #defaultIcon>
                    <p-avatar
                      icon="pi pi-folder"
                      shape="circle"
                      styleClass="bg-pink-100 text-pink-500"
                    ></p-avatar>
                  </ng-template>
                  <span
                    class="font-medium text-slate-800 block max-w-[120px] truncate sm:max-w-none"
                  >
                    {{ c.name }}
                  </span>
                  <p-badge
                    [value]="c.count"
                    severity="success"
                    class="ml-auto mr-2"
                  ></p-badge>
                </span>
              </ng-template>

              <!-- CUERPO DEL TAB -->
              <div class="space-y-4">
                <!-- Form edición categoría -->
                <form
                  [formGroup]="categoryForms[c.id]"
                  (ngSubmit)="updateCategory(c)"
                  class="flex items-center gap-2"
                >
                  <i class="pi pi-bars text-slate-400"></i>
                  <input
                    type="text"
                    pInputText
                    formControlName="name"
                    class="flex-1"
                  />
                  <button
                    type="button"
                    pButton
                    icon="pi pi-plus"
                    class="p-button-rounded p-button-success h-10 w-10"
                    (click)="
                      subCategoryForms[c.id].valid && createSubCategory(c.id)
                    "
                  ></button>
                  <button
                    type="button"
                    pButton
                    icon="pi pi-trash"
                    class="p-button-rounded p-button-danger h-10 w-10"
                    (click)="deleteCategory(c)"
                  ></button>
                </form>

                <!-- Subcategorías -->
                <div
                  class="pl-8 mt-3 space-y-2"
                  *ngIf="c.subcategories?.length"
                >
                  <div
                    *ngFor="let sub of c.subcategories"
                    class="flex items-center gap-2"
                  >
                    <i class="pi pi-angle-right text-slate-400"></i>
                    <input
                      type="text"
                      pInputText
                      [value]="sub.name"
                      disabled
                      class="flex-1"
                    />
                    <button
                      type="button"
                      pButton
                      icon="pi pi-trash"
                      class="p-button-rounded p-button-danger h-10 w-10"
                      (click)="deleteCategory(sub)"
                    ></button>
                  </div>
                </div>

                <!-- Crear subcategoría -->
                <form
                  [formGroup]="subCategoryForms[c.id]"
                  (ngSubmit)="createSubCategory(c.id)"
                  class="pl-8 mt-3 flex items-center gap-2"
                >
                  <i class="pi pi-angle-right text-slate-400"></i>
                  <input
                    type="text"
                    pInputText
                    formControlName="name"
                    placeholder="Nueva Subcategoría"
                    class="flex-1"
                  />
                  <button
                    type="submit"
                    pButton
                    icon="pi pi-plus"
                    class="p-button-rounded p-button-success h-10 w-10"
                    [disabled]="subCategoryForms[c.id].invalid"
                  ></button>
                </form>
              </div>
            </p-accordionTab>
          </p-accordion>
        </ng-container>

        <!-- Estado vacío -->
        <ng-template #emptyTpl>
          <div
            class="bg-white border border-slate-200 rounded-2xl shadow-sm p-10 text-center"
          >
            <div
              class="mx-auto w-14 h-14 rounded-2xl bg-pink-50 flex items-center justify-center text-pink-500 mb-3"
            >
              <i class="pi pi-tags text-2xl"></i>
            </div>
            <h3 class="text-lg font-semibold text-slate-800">
              Aún no tienes categorías
            </h3>
            <p class="text-sm text-slate-500 mt-1">
              Crea tu primera categoría para organizar tus productos.
            </p>
          </div>
        </ng-template>
      </div>
    </p-tabPanel>

    <!-- TAB 2: Categorías especiales -->
  <!-- TAB 2: Categorías especiales -->
<p-tabPanel header="Categorías Especiales">
  <!-- Crear nueva categoría especial -->
  <div class="px-4 sm:px-12 mb-6">
    <form
      [formGroup]="newSpecialCategoryForm"
      (ngSubmit)="createSpecialCategory()"
      class="flex flex-col sm:flex-row items-center gap-3"
    >
      <!-- Nombre -->
      <input
        type="text"
        pInputText
        formControlName="name"
        placeholder="Nueva categoría especial"
        class="flex-1"
      />

      <!-- Tipo de categoría especial -->
      <p-dropdown
        [options]="specialTypes"
        formControlName="type"
        placeholder="Tipo"
        optionLabel="label"
        optionValue="value"
      ></p-dropdown>

      <!-- Botón crear -->
      <button
        type="submit"
        pButton
        icon="pi pi-plus"
        class="p-button-rounded p-button-success"
        [disabled]="newSpecialCategoryForm.invalid"
      ></button>
    </form>
  </div>

  <div class="px-4 sm:px-12">
    <ng-container *ngIf="specialCategories?.length; else emptySpecialTpl">
      <p-accordion
        class="w-full"
        expandIcon="pi pi-plus"
        collapseIcon="pi pi-minus"
      >
        <p-accordionTab *ngFor="let sc of specialCategories">
          <!-- HEADER -->
          <ng-template pTemplate="header">
            <span class="flex items-center gap-3 w-full">
              <p-avatar
                icon="pi pi-star"
                shape="circle"
                styleClass="bg-yellow-100 text-yellow-600"
              ></p-avatar>
              <span
                class="font-medium text-slate-800 block max-w-[120px] truncate sm:max-w-none"
              >
                {{ sc.name }}
              </span>
              <p-chip
                [label]="sc.type"
                class="ml-auto"
                styleClass="bg-pink-50 text-pink-500"
              ></p-chip>
            </span>
          </ng-template>

          <!-- CUERPO DEL TAB (solo edición / borrado, sin subcategorías) -->
          <div class="space-y-4">
            <!-- Form edición categoría especial -->
            <form
              [formGroup]="categoryForms[sc.id]"
              (ngSubmit)="updateCategory(sc)"
              class="flex items-center gap-2"
            >
              <i class="pi pi-bars text-slate-400"></i>
              <input
                type="text"
                pInputText
                formControlName="name"
                class="flex-1"
              />
              <button
                type="button"
                pButton
                icon="pi pi-trash"
                class="p-button-rounded p-button-danger h-10 w-10"
                (click)="deleteCategory(sc)"
              ></button>
            </form>
          </div>
        </p-accordionTab>
      </p-accordion>
    </ng-container>

    <!-- Estado vacío -->
    <ng-template #emptySpecialTpl>
      <div
        class="bg-white border border-slate-200 rounded-2xl shadow-sm p-10 text-center"
      >
        <div
          class="mx-auto w-14 h-14 rounded-2xl bg-yellow-50 flex items-center justify-center text-yellow-600 mb-3"
        >
          <i class="pi pi-star text-2xl"></i>
        </div>
        <h3 class="text-lg font-semibold text-slate-800">
          Aún no tienes categorías especiales
        </h3>
        <p class="text-sm text-slate-500 mt-1">
          Aquí podrás crear promociones, ofertas o productos destacados.
        </p>
      </div>
    </ng-template>
  </div>
</p-tabPanel>

  </p-tabView>
</div>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
