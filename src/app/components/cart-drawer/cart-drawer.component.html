<div class="fixed inset-0 z-50" *ngIf="open">
  <!-- Backdrop -->
  <div
    class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity"
    (click)="close.emit()"
  ></div>

  <!-- Drawer lateral -->
  <aside
    class="absolute right-0 top-0 h-full w-full sm:w-[420px] bg-white flex flex-col rounded-l-2xl shadow-2xl overflow-hidden animate-slideIn"
    (touchstart)="onTouchStart($event)"
    (touchmove)="onTouchMove($event)"
    (touchend)="onTouchEnd()"
  >
    <!-- Header -->
    <header
      class="px-6 py-5 border-b border-gray-200 flex items-center justify-between"
    >
      <h2 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
        üõçÔ∏è Carrito de compras
      </h2>
      <button
        pButton
        icon="pi pi-times"
        [text]="true"
        class="!p-2 text-gray-500 hover:text-gray-800"
        (click)="close.emit()"
      ></button>
    </header>

    <!-- Contenido -->
    <div class="flex-1 overflow-y-auto divide-y divide-gray-100">
      <!-- Carrito vac√≠o -->
      <div *ngIf="items.length === 0" class="p-10 text-center text-gray-500">
        Tu carrito est√° vac√≠o üõí
      </div>

      <!-- Productos -->
      <div
        *ngFor="let it of items"
        class="flex gap-4 items-start p-5 hover:bg-gray-50 transition"
      >
        <!-- Imagen -->
        <img
          [src]="it.product?.imagen_url?.[0] || 'https://placehold.co/80x80?text=%20'"
          [alt]="it.product?.nombre_producto"
          class="w-20 h-20 rounded-xl border border-gray-200 object-cover shadow-sm"
        />

        <!-- Info -->
        <div class="flex-1 min-w-0">
          <p class="font-medium text-gray-900 leading-tight">
            {{ it.product?.nombre_producto }}
          </p>
          <p
            *ngIf="it.variant"
            class="text-xs text-gray-500 mt-1"
          >
            Variante: <span class="font-medium">{{ it.variant?.nombre }}</span>
          </p>

          <!-- Cantidad -->
          <div class="mt-3 flex items-center gap-2">
            <p-inputNumber
              [(ngModel)]="it.cantidad"
              [min]="1"
              [max]="99"
              mode="decimal"
              showButtons="true"
              buttonLayout="horizontal"
              decrementButtonClass="p-button-text text-gray-600 hover:text-gray-900"
              incrementButtonClass="p-button-text text-gray-600 hover:text-gray-900"
              inputStyleClass="w-12 text-center"
              (onInput)="updateQty.emit({ itemId: it.id, cantidad: it.cantidad })"
            ></p-inputNumber>

            <button
              pButton
              icon="pi pi-trash"
              [text]="true"
              severity="danger"
              class="!p-1 text-gray-400 hover:text-rose-600 transition"
              (click)="remove.emit(it.id)"
            ></button>
          </div>
        </div>

        <!-- Precio -->
        <div class="text-right">
          <p class="font-semibold text-emerald-700 text-sm">
            {{ it.subtotal | currency : 'ARS' : 'symbol-narrow' : '1.0-0' }}
          </p>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="p-5 border-t border-gray-200 bg-white">
      <div class="flex items-center justify-between mb-5">
        <span class="text-sm text-gray-500">Total</span>
        <span class="text-xl font-bold text-emerald-700">{{
          total | currency : 'ARS' : 'symbol-narrow' : '1.0-0'
        }}</span>
      </div>

      <!-- Botones -->
      <div class="flex flex-col gap-3">
        <!-- Vaciar -->
        <button
          type="button"
          class="w-full rounded-full px-5 py-2.5 font-medium text-sm border border-rose-500 text-rose-600 hover:bg-rose-50 hover:text-rose-700 transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-50"
          (click)="clear.emit()"
          [disabled]="!items.length"
        >
          <i class="pi pi-trash text-xs"></i> Vaciar carrito
        </button>

        <!-- Checkout -->
        <button
          type="button"
          class="w-full rounded-full px-5 py-3 font-semibold text-white text-sm shadow-md bg-emerald-600 hover:bg-emerald-700 transition-all duration-300 flex items-center justify-center gap-2 disabled:opacity-50"
          [disabled]="!items.length"
          [routerLink]="['/store', slug, 'checkout-data']"
        >
          <i class="pi pi-credit-card text-xs"></i> Ir al checkout
        </button>
      </div>
    </footer>
  </aside>
</div>
