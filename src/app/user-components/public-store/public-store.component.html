<div
  class="min-h-[100dvh]"
  [style.--primary]="store?.primary_color || '#ff4081'"
  [style.--secondary]="store?.secondary_color || '#00bfa5'"
  [style.--bg]="store?.background_color === 'dark' ? '#202123' : '#ffffff'"
  [style.--text]="store?.background_color === 'dark' ? '#f5f5f5' : '#111827'"
  [style.--surface]="store?.background_color === 'dark' ? '#2a2b32' : '#f9fafb'"
  [ngStyle]="{ backgroundColor: 'var(--bg)', color: 'var(--text)' }"
>
  <!-- ===== Loading / Error m√≠nimos ===== -->
  <div *ngIf="isLoading" class="p-6 text-slate-500">Cargando tienda‚Ä¶</div>
  <div *ngIf="!isLoading && hasError" class="p-6 text-rose-600">
    No se pudo cargar la tienda.
  </div>

  <ng-container *ngIf="!isLoading && !hasError">
    <!-- ===== HERO HEADER ===== -->
    <header class="relative w-full h-48 sm:h-64 overflow-hidden">
      <img
        [src]="
          store?.banner_url ||
          store?.portada_url ||
          store?.imagen_portada ||
          'https://placehold.co/1200x400?text=Tienda'
        "
        [alt]="'Portada ' + (store?.nombre_tienda || slug || 'Tienda')"
        class="absolute inset-0 w-full h-full object-cover"
      />
      <div
        class="absolute inset-0 bg-gradient-to-b from-black/0 via-black/30 to-black/70"
      ></div>

      <div
        class="relative z-10 h-full max-w-6xl mx-auto px-4 sm:px-8 flex flex-col justify-end pb-4"
      >
        <h1 class="text-2xl sm:text-3xl font-semibold text-white drop-shadow">
          {{ store?.nombre_tienda || slug || "Tienda" }}
        </h1>

        <!-- Rubros -->
        <div *ngIf="rubros().length" class="mt-6 text-sm">
          <span class="font-medium">Rubros:&nbsp;</span>
          <span class="inline-flex flex-wrap gap-1 align-middle">
            <span
              *ngFor="let r of rubros()"
              class="px-2 py-0.5 rounded-full bg-[var(--secondary)]/20 text-[var(--secondary)]"
            >
              {{ r }}
            </span>
          </span>
        </div>

        <!-- Descripci√≥n -->
        <p
          *ngIf="store?.descripcion"
          class="text-white/90 text-sm mt-1 line-clamp-2"
          [innerHTML]="store.descripcion"
        ></p>

        <!-- L√≠nea de info -->
        <p class="text-white/90 text-sm mt-1 flex flex-wrap gap-x-2 gap-y-0.5">
          <span *ngIf="store?.tiempo_entrega">{{ store?.tiempo_entrega }}</span>
          <span
            *ngIf="
              store?.tiempo_entrega &&
              (store?.costo_envio || store?.pedido_minimo)
            "
            >¬∑</span
          >
          <span *ngIf="store?.costo_envio">
            {{
              store.costo_envio | currency : "ARS" : "symbol-narrow" : "1.0-0"
            }}
            env√≠o
          </span>
          <span *ngIf="store?.costo_envio && store?.pedido_minimo">¬∑</span>
          <span *ngIf="store?.pedido_minimo">
            M√≠nimo
            {{
              store.pedido_minimo | currency : "ARS" : "symbol-narrow" : "1.0-0"
            }}
          </span>
        </p>

        <!-- Buscador -->
        <div class="mt-3 w-full max-w-3xl">
          <div class="relative">
            <input
              type="text"
              placeholder="Buscar productos..."
              class="w-full h-10 sm:h-11 rounded-full pl-4 pr-12 text-[var(--text)] placeholder-slate-400 shadow-md focus:outline-none"
            />
            <button
              type="button"
              class="absolute right-1.5 top-1.5 h-7 w-7 sm:h-8 sm:w-8 rounded-full grid place-items-center shadow"
              aria-label="Buscar"
              [ngStyle]="{ backgroundColor: 'var(--secondary)' }"
            >
              <mat-icon class="!text-white !text-[18px] sm:!text-[20px]"
                >search</mat-icon
              >
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 sm:px-8 pb-10 mt-6 space-y-10">
      <!-- üåü CATEGOR√çAS DESTACADAS -->
      <!-- üåü CATEGOR√çAS DESTACADAS -->
<section *ngIf="featuredCategories.length">
  <div
    class="rounded-2xl border shadow-lg p-4 transition-colors"
    [ngStyle]="{
      backgroundColor: 'var(--surface)',
      color: 'var(--text)',
      borderColor:
        store?.background_color === 'dark'
          ? 'rgba(255,255,255,0.08)'
          : '#e5e7eb'
    }"
  >
    <h3 class="text-sm font-semibold flex items-center gap-2 mb-4">
      <mat-icon
        class="!text-[18px]"
        [ngStyle]="{ color: 'var(--primary)' }"
        >star</mat-icon
      >
      Categor√≠as destacadas
    </h3>

    <p-carousel
      [value]="featuredCategories"
      [numVisible]="2"
      [numScroll]="1"
      [circular]="true"
      [autoplayInterval]="4000"
      styleClass="custom-carousel"
    >
      <ng-template pTemplate="item" let-cat>
        <a
          [routerLink]="['/store', slug, 'categoria', cat.slug]"
          class="block rounded-2xl border shadow hover:shadow-lg transition p-4 h-full bg-[var(--surface)]"
          [ngStyle]="{
            color: 'var(--text)',
            borderColor:
              store?.background_color === 'dark'
                ? 'rgba(255,255,255,0.1)'
                : '#e5e7eb'
          }"
        >
          <div class="flex flex-col items-center text-center gap-2">
            <img
              [src]="cat.imageUrl || '../../../assets/lomito.jpg'"
              [alt]="cat.name"
              class="h-20 w-20 object-contain rounded-xl"
            />
            <div
              class="font-semibold text-sm"
              [ngStyle]="{ color: 'var(--secondary)' }"
            >
              {{ cat.name }}
            </div>
            <div class="text-xs text-slate-500">
              {{ cat.count }}
              {{ cat.count === 1 ? 'producto' : 'productos' }}
            </div>
            <p-tag
              *ngIf="cat.type"
              [value]="cat.type"
              severity="warning"
              class="mt-2 text-xs uppercase"
            ></p-tag>
          </div>
        </a>
      </ng-template>
    </p-carousel>
  </div>
</section>


      <!-- üè∑Ô∏è CATEGOR√çAS NORMALES -->
      <section *ngIf="normalCategories.length">
        <div
          class="rounded-2xl border shadow-lg p-4 transition-colors"
          [ngStyle]="{
            backgroundColor: 'var(--surface)',
            color: 'var(--text)',
            borderColor:
              store?.background_color === 'dark'
                ? 'rgba(255,255,255,0.08)'
                : '#e5e7eb'
          }"
        >
          <h3 class="text-sm font-semibold flex items-center gap-2">
            <mat-icon
              class="!text-[18px]"
              [ngStyle]="{ color: 'var(--primary)' }"
              >category</mat-icon
            >
            Categor√≠as
          </h3>

          <div class="mt-4">
            <ng-container *ngIf="normalCategories.length; else noCat">
              <p-dataView [value]="normalCategories" layout="grid" [rows]="6">
                <ng-template pTemplate="grid" let-items>
                  <div
                    class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-4 w-full"
                  >
                    <div *ngFor="let c of items" class="col">
                      <a
                        [routerLink]="['/store', slug, 'categoria', c.slug]"
                        class="block rounded-2xl border shadow-2xl hover:shadow-lg transition p-4"
                        [ngStyle]="{
                          backgroundColor: 'var(--surface)',
                          color: 'var(--text)'
                        }"
                      >
                        <div class="w-full flex justify-center mb-3">
                          <img
                            [src]="c.imageUrl || '../../../assets/lomito.jpg'"
                            [alt]="c.name"
                            class="h-20 w-20 object-contain rounded-xl"
                          />
                        </div>

                        <div class="text-center">
                          <div
                            class="font-semibold text-sm"
                            [ngStyle]="{ color: 'var(--secondary)' }"
                          >
                            {{ c.name }}
                          </div>
                          <div class="text-xs mt-1 text-slate-500">
                            {{ c.count }}
                            {{ c.count === 1 ? "producto" : "productos" }}
                          </div>
                        </div>
                      </a>
                    </div>
                  </div>
                </ng-template>
              </p-dataView>
            </ng-container>

            <ng-template #noCat>
              <p class="text-slate-400">Sin categor√≠as a√∫n.</p>
            </ng-template>
          </div>
        </div>
      </section>
    </main>
  </ng-container>
</div>
