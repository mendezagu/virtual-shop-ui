<div class="min-h-[100dvh] bg-neutral-50">
  <!-- ===== Loading / Error mínimos ===== -->
  <div *ngIf="isLoading" class="p-6 text-slate-500">Cargando tienda…</div>
  <div *ngIf="!isLoading && hasError" class="p-6 text-rose-600">
    No se pudo cargar la tienda.
  </div>

  <ng-container *ngIf="!isLoading && !hasError">
    <!-- ===== HERO HEADER estilo PedidosYa ===== -->
    <header class="relative w-full h-48 sm:h-64 overflow-hidden">
      <img
        [src]="
          store?.banner_url ||
          store?.portada_url ||
          store?.imagen_portada ||
          'https://placehold.co/1200x400?text=Tienda'
        "
        [alt]="'Portada ' + (store?.nombre_tienda || slug || 'Tienda')"
        class="absolute inset-0 w-full h-full object-cover"
      />
      <div
        class="absolute inset-0 bg-gradient-to-b from-black/0 via-black/30 to-black/70"
      ></div>

      <div
        class="relative z-10 h-full max-w-6xl mx-auto px-4 sm:px-8 flex flex-col justify-end pb-4"
      >
        <h1 class="text-2xl sm:text-3xl font-semibold text-white drop-shadow">
          {{ store?.nombre_tienda || slug || "Tienda" }}
        </h1>

        <!-- Rubros -->
        <div *ngIf="rubros().length" class="mt-6 text-sm text-slate-600">
          <span class="font-medium text-slate-800">Rubros:&nbsp;</span>
          <span class="inline-flex flex-wrap gap-1 align-middle">
            <span
              *ngFor="let r of rubros()"
              class="px-2 py-0.5 rounded-full bg-slate-100 text-slate-700"
            >
              {{ r }}
            </span>
          </span>
        </div>

        <!-- Descripción -->
        <p
          *ngIf="store?.descripcion"
          class="text-white/90 text-sm mt-1 line-clamp-2"
        >
          {{ store.descripcion }}
        </p>

        <!-- Línea de info -->
        <p class="text-white/90 text-sm mt-1 flex flex-wrap gap-x-2 gap-y-0.5">
          <span *ngIf="store?.tiempo_entrega">{{ store.tiempo_entrega }}</span>
          <span
            *ngIf="
              store?.tiempo_entrega &&
              (store?.costo_envio || store?.pedido_minimo)
            "
            >·</span
          >
          <span *ngIf="store?.costo_envio">
            {{
              store.costo_envio | currency : "ARS" : "symbol-narrow" : "1.0-0"
            }}
            envío
          </span>
          <span *ngIf="store?.costo_envio && store?.pedido_minimo">·</span>
          <span *ngIf="store?.pedido_minimo">
            Mínimo
            {{
              store.pedido_minimo | currency : "ARS" : "symbol-narrow" : "1.0-0"
            }}
          </span>
        </p>

        <!-- Buscador -->
        <div class="mt-3 w-full max-w-3xl">
          <div class="relative">
            <input
              type="text"
              placeholder="Buscar productos..."
              class="w-full h-10 sm:h-11 rounded-full pl-4 pr-12 bg-white text-slate-700 placeholder-slate-400 shadow-md focus:outline-none"
            />
            <button
              type="button"
              class="absolute right-1.5 top-1.5 h-7 w-7 sm:h-8 sm:w-8 rounded-full grid place-items-center shadow"
              aria-label="Buscar"
              [ngStyle]="{ backgroundColor: 'var(--secondary)' }"
            >
              <mat-icon class="!text-white !text-[18px] sm:!text-[20px]">
                search
              </mat-icon>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- ===== LAYOUT: contenido + sidebar ===== -->
    <main
      class="max-w-6xl mx-auto px-4 sm:px-8 pb-10 grid grid-cols-1 lg:grid-cols-12 gap-6 mt-6"
    >
      <!-- Contenido principal -->
      <section class="lg:col-span-8">
        <div class="rounded-2xl border border-slate-200 bg-white shadow-sm p-4">
          <h3
            class="text-sm font-semibold text-slate-800 flex items-center gap-2"
          >
            <mat-icon
              class="!text-[18px]"
              [ngStyle]="{ color: 'var(--primary)' }"
              >category</mat-icon
            >
            Categorías
          </h3>

         <div class="mt-4">
  <ng-container *ngIf="categories?.length; else noCat">
    <p-dataView [value]="categories" layout="grid" [rows]="6">
      <ng-template pTemplate="grid" let-items>
        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-4 w-full">
          <div *ngFor="let c of items" class="col">
            <a
              [routerLink]="['/store', slug, 'categoria', c.slug]"
              class="block rounded-2xl border border-slate-200 bg-white p-4 shadow-sm hover:shadow-md transition group"
            >
              <!-- Imagen / fallback -->
              <div class="w-full flex justify-center mb-3">
                <ng-container *ngIf="c.imageUrl; else fallbackBubble">
                  <img
                    [src]="c.imageUrl"
                    [alt]="c.name"
                    class="h-20 w-20 object-contain rounded-xl"
                  />
                </ng-container>
                <ng-template #fallbackBubble>
                  <div
                    class="h-20 w-20 rounded-xl flex items-center justify-center text-white text-xl font-bold"
                    [ngStyle]="{
                      background:
                        'linear-gradient(to bottom right, var(--primary), var(--secondary))'
                    }"
                  >
                    {{ c.name[0] }}
                  </div>
                </ng-template>
              </div>

              <!-- Texto -->
              <div class="text-center">
                <div
                  class="font-semibold text-sm text-slate-800 group-hover:text-[var(--primary)] transition"
                >
                  {{ c.name }}
                </div>
                <div class="text-xs text-slate-500 mt-1">
                  {{ c.count }}
                  {{ c.count === 1 ? "producto" : "productos" }}
                </div>
              </div>
            </a>
          </div>
        </div>
      </ng-template>
    </p-dataView>
  </ng-container>

  <ng-template #noCat>
    <p class="text-slate-400">Sin categorías aún.</p>
  </ng-template>
</div>

        </div>
      </section>

      <!-- Sidebar -->
      <aside class="lg:col-span-4 space-y-4">
        <!-- Contacto -->
        <div class="rounded-2xl border border-slate-200 bg-white shadow-sm p-4">
          <h3
            class="text-sm font-semibold text-slate-800 flex items-center gap-2"
          >
            <mat-icon
              class="!text-[18px]"
              [ngStyle]="{ color: 'var(--primary)' }"
              >call</mat-icon
            >
            Contacto
          </h3>
          <div class="mt-2 text-sm text-slate-600 space-y-1.5">
            <div *ngIf="store?.telefono_contacto">
              <span class="font-medium">Teléfono:</span>
              {{ store.telefono_contacto }}
            </div>
            <div *ngIf="store?.email">
              <span class="font-medium">Email:</span> {{ store.email }}
            </div>
            <div *ngIf="store?.web">
              <span class="font-medium">Web:</span>
              <a
                class="hover:underline"
                [ngStyle]="{ color: 'var(--secondary)' }"
                [href]="store.web"
                target="_blank"
                rel="noopener"
                >Abrir sitio</a
              >
            </div>
            <div *ngIf="store?.instagram">
              <span class="font-medium">Instagram:</span>
              <a
                class="hover:underline"
                [ngStyle]="{ color: 'var(--secondary)' }"
                [href]="store.instagram"
                target="_blank"
                rel="noopener"
              >
                {{ getInstagramHandle(store.instagram) }}
              </a>
            </div>
          </div>
        </div>

        <!-- Ubicación -->
        <div class="rounded-2xl border border-slate-200 bg-white shadow-sm p-4">
          <h3
            class="text-sm font-semibold text-slate-800 flex items-center gap-2"
          >
            <mat-icon
              class="!text-[18px]"
              [ngStyle]="{ color: 'var(--primary)' }"
              >location_on</mat-icon
            >
            Ubicación
          </h3>
          <div class="mt-2 text-sm text-slate-600 space-y-1.5">
            <div *ngIf="store?.direccion">
              <span class="font-medium">Dirección:</span>
              {{ store.direccion }}
            </div>
            <div *ngIf="store?.ciudad || store?.provincia">
              <span class="font-medium">Ciudad:</span> {{ store.ciudad }}
              <span *ngIf="store?.provincia">({{ store.provincia }})</span>
            </div>
            <a
              *ngIf="store?.direccion"
              class="inline-flex items-center gap-1 hover:underline mt-1"
              [ngStyle]="{ color: 'var(--secondary)' }"
              [href]="
                'https://www.google.com/maps/search/?api=1&query=' +
                store.direccion
              "
              target="_blank"
              rel="noopener"
            >
              Ver en Google Maps
              <mat-icon class="!text-[16px]">open_in_new</mat-icon>
            </a>
          </div>
        </div>

        <!-- Horarios -->
        <div class="rounded-2xl border border-slate-200 bg-white shadow-sm p-4">
          <h3
            class="text-sm font-semibold text-slate-800 flex items-center gap-2"
          >
            <mat-icon
              class="!text-[18px]"
              [ngStyle]="{ color: 'var(--primary)' }"
              >schedule</mat-icon
            >
            Horarios
          </h3>
          <div class="mt-2 text-sm text-slate-600">
            <ul
              *ngIf="store?.horarios?.length; else horarioTexto"
              class="space-y-1"
            >
              <li *ngFor="let h of store.horarios" class="flex justify-between">
                <span class="text-slate-700">{{ h?.dia || h?.label }}</span>
                <span class="font-medium">{{ h?.desde }} - {{ h?.hasta }}</span>
              </li>
            </ul>
            <ng-template #horarioTexto>
              <p *ngIf="store?.horario_cierre" class="whitespace-pre-line">
                {{ store.horario_apertura }} - {{ store.horario_cierre }}
              </p>
              <p
                *ngIf="!store?.horarios && !store?.horario_apertura"
                class="text-slate-400"
              >
                No informado.
              </p>
            </ng-template>
          </div>
        </div>
      </aside>
    </main>
  </ng-container>
</div>
