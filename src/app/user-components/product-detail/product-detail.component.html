<div
  class="min-h-screen w-full font-sans transition-colors duration-300"
  [style.--primary]="product?.store?.primary_color || '#7e22ce'"
  [style.--secondary]="product?.store?.secondary_color || '#ec4899'"
  [style.--bg]="
    product?.store?.background_color === 'dark' ? '#18181b' : '#ffffff'
  "
  [style.--surface]="
    product?.store?.background_color === 'dark' ? '#27272a' : '#f9fafb'
  "
  [style.--text]="
    product?.store?.background_color === 'dark' ? '#f4f4f5' : '#111827'
  "
  [ngStyle]="{
    backgroundColor: 'var(--bg)',
    color: 'var(--text)'
  }"
>
  <!-- ===== CONTENEDOR PRINCIPAL ===== -->
  <div class="relative max-w-3xl mx-auto p-6 space-y-6">
    <!-- ðŸ–¼ï¸ CARRUSEL DE IMÃGENES -->
    <div class="flex justify-center">
      <p-carousel
        *ngIf="product?.imagen_url?.length > 0; else noImageTpl"
        [value]="product.imagen_url"
        [numVisible]="1"
        [numScroll]="1"
        [circular]="true"
        [autoplayInterval]="4000"
        styleClass="w-full max-w-md"
      >
        <ng-template pTemplate="item" let-img>
          <div class="flex justify-center">
            <img
              [src]="img"
              [alt]="product?.nombre_producto"
              class="h-64 sm:h-72 object-contain rounded-2xl shadow-lg transition-transform duration-300 hover:scale-[1.02]"
            />
          </div>
        </ng-template>
      </p-carousel>

      <ng-template #noImageTpl>
        <img
          src="https://placehold.co/400x400?text=Producto"
          [alt]="product?.nombre_producto"
          class="h-64 sm:h-72 object-contain rounded-2xl shadow-md opacity-80"
        />
      </ng-template>
    </div>

    <!-- ðŸ·ï¸ INFORMACIÃ“N -->
    <div class="text-center space-y-2">
      <h1
        class="text-2xl font-bold tracking-tight"
        [ngStyle]="{ color: 'var(--primary)' }"
      >
        {{ product?.nombre_producto }}
      </h1>
      <p class="text-sm opacity-80 leading-relaxed max-w-md mx-auto">
        {{ product?.descripcion }}
      </p>
    </div>

    <!-- ðŸ§© VARIANTES -->
    <div
      *ngIf="product?.presentacion_multiple && product?.variants?.length"
      class="space-y-3"
    >
      <h3 class="text-lg font-semibold" [ngStyle]="{ color: 'var(--primary)' }">
        Presentaciones
      </h3>

      <div
        *ngFor="let v of product.variants"
        class="flex items-center justify-between border rounded-xl px-4 py-3 transition-all hover:shadow-sm"
        [ngStyle]="{
          backgroundColor: 'var(--surface)',
          color: 'var(--text)',
          borderColor:
            product?.store?.background_color === 'dark'
              ? 'rgba(255,255,255,0.08)'
              : '#e5e7eb'
        }"
      >
        <div class="flex items-center gap-2">
          <p-checkbox
            [binary]="true"
            [ngModel]="selectedVariants.has(v.id_variant)"
            (onChange)="toggleVariant(v.id_variant, $event.checked)"
            inputId="variant-{{ v.id_variant }}"
          ></p-checkbox>
          <label
            for="variant-{{ v.id_variant }}"
            class="text-sm font-medium cursor-pointer"
            [ngStyle]="{ color: 'var(--primary)' }"
            >{{ v.nombre }}</label
          >
        </div>

        <div
          class="flex items-center gap-3"
          *ngIf="selectedVariants.has(v.id_variant)"
        >
          <div
            class="flex items-center border rounded-full shadow-inner overflow-hidden"
          >
            <button
              pButton
              type="button"
              icon="pi pi-minus"
              class="p-button-text text-slate-500 hover:text-slate-700"
              (click)="decrement(v.id_variant)"
            ></button>
            <input
              type="number"
              min="0"
              [(ngModel)]="qty[v.id_variant]"
              class="w-10 text-center text-sm bg-transparent border-0 focus:ring-0"
            />
            <button
              pButton
              type="button"
              icon="pi pi-plus"
              class="p-button-text text-slate-500 hover:text-slate-700"
              (click)="increment(v.id_variant)"
            ></button>
          </div>
          <span
            class="text-sm font-semibold"
            [ngStyle]="{ color: 'var(--secondary)' }"
          >
            {{ v.precio | currency : "ARS" : "symbol-narrow" : "1.0-0" }}
          </span>
        </div>
      </div>
    </div>

    <!-- ðŸ§º PRODUCTO SIMPLE -->
    <div *ngIf="!product?.presentacion_multiple" class="space-y-5">
      <div
        class="border rounded-xl p-4 flex items-center justify-between"
        [ngStyle]="{
          backgroundColor: 'var(--surface)',
          color: 'var(--text)'
        }"
      >
        <span class="font-medium" [ngStyle]="{ color: 'var(--primary)' }"
          >Unidades</span
        >
        <div class="flex items-center border rounded-full shadow-inner">
          <button
            pButton
            type="button"
            icon="pi pi-minus"
            class="p-button-text text-slate-500 hover:text-slate-700"
            (click)="decrement('single')"
          ></button>
          <input
            type="number"
            min="1"
            [(ngModel)]="qty['single']"
            class="w-10 text-center text-sm bg-transparent border-0 focus:ring-0"
          />
          <button
            pButton
            type="button"
            icon="pi pi-plus"
            class="p-button-text text-slate-500 hover:text-slate-700"
            (click)="increment('single')"
          ></button>
        </div>
      </div>

      <div>
        <label
          class="block text-sm font-semibold mb-1"
          [ngStyle]="{ color: 'var(--primary)' }"
        >
          Â¿QuerÃ©s aclarar algo?
        </label>
        <textarea
          pInputTextarea
          [(ngModel)]="observaciones"
          maxlength="250"
          rows="2"
          placeholder="Notas al producto..."
          class="w-full border rounded-xl px-3 py-2 text-sm focus:ring-2 bg-transparent shadow-sm"
          [ngStyle]="{ '--tw-ring-color': 'var(--primary)' }"
        ></textarea>
        <p class="text-xs opacity-70 text-right mt-1">
          {{ observaciones.length }}/250
        </p>
      </div>
    </div>

    <!-- ðŸ§¾ FOOTER / AGREGAR -->
    <div class="sticky bottom-0 pt-4 pb-3 bg-transparent border-0 shadow-none">
      <button
        pButton
        type="button"
        class="w-full rounded-full py-3 font-semibold text-base flex items-center justify-between px-6 shadow-md hover:shadow-lg hover:scale-[1.02] transition-all duration-300"
        [ngStyle]="{
          backgroundColor: 'var(--secondary)',
          color: '#fff'
        }"
        (click)="addToCart()"
      >
        <span>Agregar al carrito</span>
        <span>{{ total | currency : "ARS" : "symbol-narrow" : "1.0-0" }}</span>
      </button>
    </div>

    <!-- ðŸ›ï¸ DRAWER DEL CARRITO -->
    <app-cart-drawer
      [open]="cartOpen"
      [items]="cart?.items ?? []"
      [total]="cart?.total ?? 0"
      (close)="cartOpen = false"
      [slug]="slug"
      (updateQty)="onUpdateQty($event)"
      (remove)="onRemove($event)"
      (clear)="onClear()"
    ></app-cart-drawer>
  </div>
</div>
